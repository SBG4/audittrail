---
phase: 03-timeline-events
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - client/src/components/timeline/InlineField.tsx
  - client/src/components/timeline/TimelineRow.tsx
  - client/src/hooks/useEvents.ts
autonomous: true

must_haves:
  truths:
    - "User can click any event field and edit it inline"
    - "Changes save optimistically with instant UI feedback"
    - "Failed saves roll back to previous value"
    - "Edit mode shows appropriate input type for each field"
  artifacts:
    - path: "client/src/components/timeline/InlineField.tsx"
      provides: "Reusable click-to-edit field component"
    - path: "client/src/components/timeline/TimelineRow.tsx"
      provides: "Updated row with inline editing for all fields"
    - path: "client/src/hooks/useEvents.ts"
      provides: "Updated hooks with optimistic update callbacks"
  key_links:
    - from: "client/src/components/timeline/TimelineRow.tsx"
      to: "client/src/components/timeline/InlineField.tsx"
      via: "import and render for each editable field"
    - from: "client/src/hooks/useEvents.ts"
      to: "TanStack Query cache"
      via: "onMutate/onError/onSettled optimistic callbacks"
---

<objective>
Add inline editing to timeline events with optimistic updates. Users click any field to edit it in place, with instant UI feedback and background persistence.

Purpose: Inline editing workflow (EVNT-02, EVNT-07)
Output: InlineField component, updated TimelineRow with editing, optimistic update hooks
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@client/src/hooks/useEvents.ts
@client/src/components/timeline/TimelineRow.tsx
@.planning/phases/03-timeline-events/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: InlineField component and optimistic update hooks</name>
  <files>
    client/src/components/timeline/InlineField.tsx
    client/src/hooks/useEvents.ts
  </files>
  <action>
    Create client/src/components/timeline/InlineField.tsx:
    - Generic reusable component for click-to-edit fields
    - Props:
      - value: string | number | null (current display value)
      - onSave: (value: string) => void (called when user commits edit)
      - type?: "text" | "number" | "date" | "time" (default "text")
      - placeholder?: string (shown when value is empty in display mode)
      - className?: string
    - Display mode: Shows value as text span. If empty/null, shows placeholder in muted italic. Click activates edit mode.
    - Edit mode:
      - Renders <input> of appropriate type
      - autoFocus on mount
      - Value initialized from current value
      - onBlur: save and exit edit mode
      - onKeyDown:
        - Enter: save and exit edit mode
        - Escape: revert to original value and exit edit mode
        - Tab: save and exit (browser default tab behavior moves focus to next element)
      - For "number" type: parse to integer, min=0
      - For "date" type: renders native date picker input
      - For "time" type: renders native time picker input
    - Display text styling: cursor-pointer, hover:bg-muted/50, rounded, px-2 py-1
    - Input styling: match existing Input component sizing, w-full

    Update client/src/hooks/useEvents.ts to add optimistic update callbacks to useUpdateEvent:
    - onMutate: Cancel queries for ["events", caseId], snapshot previous data, optimistically update cache by mapping over items and replacing the matching event with merged data
    - onError: Rollback to previous snapshot
    - onSettled: Invalidate ["events", caseId] to refetch fresh data
    - Pattern: exact same as TanStack Query optimistic update docs

    The mutation function signature: ({ id, ...body }: UpdateEventRequest & { id: string })
  </action>
  <verify>No TypeScript errors. InlineField component renders input on click, saves on blur/Enter.</verify>
  <done>InlineField component handles click-to-edit with proper keyboard support, useUpdateEvent has optimistic updates</done>
</task>

<task type="auto">
  <name>Task 2: Integrate InlineField into TimelineRow</name>
  <files>
    client/src/components/timeline/TimelineRow.tsx
  </files>
  <action>
    Update TimelineRow to use InlineField for all editable columns:

    - event_type: Use a click-to-edit that renders a select (not InlineField). On click, show a dropdown with options: "finding", "action", "note". Use a simple select element or Radix Select. On change, save immediately. Show EventTypeIcon in display mode.
    - event_date: InlineField type="date", value=event.event_date, onSave calls handleFieldUpdate("event_date", value)
    - event_time: InlineField type="time", value=event.event_time, placeholder="--:--", onSave calls handleFieldUpdate("event_time", value || null)
    - file_name: InlineField type="text", value=event.file_name, placeholder="File name..."
    - file_count: InlineField type="number", value=event.file_count, placeholder="0"
    - file_description: InlineField type="text", value=event.file_description, placeholder="Description..."
    - file_type: InlineField type="text", value=event.file_type, placeholder="File type..."

    The TimelineRow receives an onFieldUpdate callback prop: (eventId: string, field: string, value: unknown) => void
    This callback is provided by TimelineView which calls updateEvent.mutate().

    Remove the previous read-only display. Each field is now editable inline.

    Keep the delete button (Trash2 icon) at the end of the row.
    Add subtle visual feedback: when updateEvent.isPending for this row, show a small spinner or opacity change.
  </action>
  <verify>No TypeScript errors. Clicking a field enters edit mode, saving updates the event.</verify>
  <done>Every event field is editable inline with optimistic feedback</done>
</task>

</tasks>

<verification>
- Click any field in a timeline row to enter edit mode
- Enter/blur saves the field value
- Escape cancels and reverts
- UI updates instantly (optimistic) without waiting for server
- Failed saves roll back to previous value
</verification>

<success_criteria>
- InlineField component supports text, number, date, time input types
- All event fields are editable inline in TimelineRow
- useUpdateEvent uses optimistic updates with rollback
- Keyboard shortcuts (Enter, Escape, Tab) work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/03-timeline-events/03-03-SUMMARY.md`
</output>
