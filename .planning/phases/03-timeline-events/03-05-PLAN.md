---
phase: 03-timeline-events
plan: 05
type: execute
wave: 4
depends_on: ["03-03", "03-04"]
files_modified:
  - client/src/components/timeline/TimelineView.tsx
  - client/src/components/timeline/TimelineRow.tsx
autonomous: true

must_haves:
  truths:
    - "User can delete an event from the timeline"
    - "Deletion requires confirmation before executing"
    - "Deleted event can be undone within a short time window"
    - "Delete is reflected immediately in the UI (optimistic)"
  artifacts:
    - path: "client/src/components/timeline/TimelineView.tsx"
      provides: "Undo toast/banner for deleted events"
    - path: "client/src/components/timeline/TimelineRow.tsx"
      provides: "Delete button with confirmation"
  key_links:
    - from: "client/src/components/timeline/TimelineRow.tsx"
      to: "client/src/hooks/useEvents.ts"
      via: "useDeleteEvent mutation"
    - from: "client/src/components/timeline/TimelineView.tsx"
      to: "TanStack Query cache"
      via: "optimistic removal and undo restoration"
---

<objective>
Add event deletion with confirmation dialog and undo capability. Events are removed optimistically from the UI with a brief undo window before permanent deletion.

Purpose: Safe event deletion (EVNT-05)
Output: Confirmation dialog, optimistic deletion, undo toast
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@client/src/components/timeline/TimelineView.tsx
@client/src/components/timeline/TimelineRow.tsx
@client/src/hooks/useEvents.ts
@client/src/components/ui/dialog.tsx
@.planning/phases/03-timeline-events/03-03-SUMMARY.md
@.planning/phases/03-timeline-events/03-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete confirmation and undo capability</name>
  <files>
    client/src/components/timeline/TimelineView.tsx
    client/src/components/timeline/TimelineRow.tsx
  </files>
  <action>
    Update TimelineRow delete interaction:
    - Replace simple delete button with a two-click confirmation:
      - First click: Button text changes from trash icon to "Confirm?" with red styling
      - If user clicks away (onBlur) or waits 3 seconds, revert to trash icon
      - Second click (on "Confirm?"): Execute deletion
    - This is lighter weight than a dialog modal for a table row action

    Update TimelineView to support undo:
    - Add state: deletedEvent (TimelineEvent | null), undoTimeout (NodeJS.Timeout | null)
    - When delete is triggered:
      1. Store the event data in deletedEvent state
      2. Optimistically remove the event from the UI (filter it from the query cache)
      3. Show an undo banner at the bottom of the timeline: "Event deleted. [Undo]" with a 5-second countdown
      4. Start a 5-second timeout. When it expires, call deleteEvent.mutate(eventId) to actually delete on the server
    - If user clicks "Undo":
      1. Clear the timeout (prevent server deletion)
      2. Restore the event to the cache
      3. Hide the undo banner
      4. Clear deletedEvent state
    - If timeout expires:
      1. Call deleteEvent.mutate(eventId) to permanently delete
      2. Hide the undo banner
      3. Clear deletedEvent state

    Undo banner styling:
    - Fixed at bottom of timeline container (not page-level)
    - bg-muted border rounded-md px-4 py-2 flex items-center justify-between
    - Text: "Event deleted." + Button: "Undo" (text-primary underline)
    - Auto-dismiss after 5 seconds if not clicked

    Update useDeleteEvent in hooks if needed to support the optimistic removal pattern. The optimistic removal happens in TimelineView state management, not in the hook's onMutate (because undo needs to delay the actual API call).
  </action>
  <verify>No TypeScript errors. Delete shows confirmation, undo banner appears, undo restores event.</verify>
  <done>Event deletion has two-click confirmation and 5-second undo window</done>
</task>

</tasks>

<verification>
- Click delete icon shows "Confirm?" state
- Clicking "Confirm?" removes event from UI immediately
- Undo banner appears for 5 seconds
- Clicking Undo restores the event
- After 5 seconds without undo, event is permanently deleted on server
</verification>

<success_criteria>
- Delete requires explicit confirmation (two clicks)
- Optimistic removal from UI on confirm
- Undo banner with 5-second window
- Undo restores event to timeline
- Permanent deletion after undo window expires
</success_criteria>

<output>
After completion, create `.planning/phases/03-timeline-events/03-05-SUMMARY.md`
</output>
