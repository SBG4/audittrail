---
phase: 03-timeline-events
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - client/src/types/event.ts
  - client/src/hooks/useEvents.ts
  - client/src/components/timeline/TimelineView.tsx
  - client/src/components/timeline/TimelineRow.tsx
  - client/src/components/timeline/EventTypeIcon.tsx
  - client/src/pages/CaseDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "Timeline tab on case detail page shows events in chronological order"
    - "Each event displays date, time, file name, file count, file description, file type"
    - "Event types (finding, action, note) display with distinct visual icons"
    - "User can add a new event via an Add Event button"
    - "Empty state shows helpful message when no events exist"
  artifacts:
    - path: "client/src/types/event.ts"
      provides: "TypeScript interfaces for events"
      exports: ["TimelineEvent", "CreateEventRequest", "UpdateEventRequest"]
    - path: "client/src/hooks/useEvents.ts"
      provides: "TanStack Query hooks for events CRUD"
      exports: ["useEvents", "useCreateEvent", "useUpdateEvent", "useDeleteEvent"]
    - path: "client/src/components/timeline/TimelineView.tsx"
      provides: "Main timeline container component"
    - path: "client/src/components/timeline/TimelineRow.tsx"
      provides: "Single event row display"
    - path: "client/src/components/timeline/EventTypeIcon.tsx"
      provides: "Icon component for event types"
  key_links:
    - from: "client/src/hooks/useEvents.ts"
      to: "/api/cases/{caseId}/events"
      via: "api.get/post/patch/delete"
    - from: "client/src/pages/CaseDetailPage.tsx"
      to: "client/src/components/timeline/TimelineView.tsx"
      via: "import and render in timeline tab"
---

<objective>
Build the Timeline UI component with chronological event display and event type icons. Replace the placeholder timeline tab in CaseDetailPage with a working timeline showing events sorted by date/time.

Purpose: Visual timeline display (EVNT-01, EVNT-04, EVNT-06)
Output: TypeScript types, TanStack Query hooks, TimelineView and TimelineRow components with event type icons
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@client/src/types/case.ts
@client/src/hooks/useCases.ts
@client/src/lib/api.ts
@client/src/pages/CaseDetailPage.tsx
@.planning/phases/03-timeline-events/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: TypeScript types and TanStack Query hooks for events</name>
  <files>
    client/src/types/event.ts
    client/src/hooks/useEvents.ts
  </files>
  <action>
    Create client/src/types/event.ts with interfaces matching the backend schemas:
    - TimelineEvent: id (string), case_id (string), event_type ("finding" | "action" | "note"), event_date (string, ISO date), event_time (string | null, HH:MM), file_name (string | null), file_count (number | null), file_description (string | null), file_type (string | null), metadata (Record<string, unknown>), sort_order (number), created_by_id (string), created_by (UserInfo | null, import from case.ts), created_at (string), updated_at (string)
    - CreateEventRequest: event_type? (string), event_date (string), event_time? (string | null), file_name? (string | null), file_count? (number | null), file_description? (string | null), file_type? (string | null), metadata? (Record<string, unknown>)
    - UpdateEventRequest: All fields optional. Same as CreateEventRequest but every field optional.
    - EventListResponse: items (TimelineEvent[]), total (number)

    Create client/src/hooks/useEvents.ts following exact same pattern as useCases.ts:
    - useEvents(caseId: string): useQuery with queryKey ["events", caseId], fetches GET /api/cases/{caseId}/events, returns EventListResponse. staleTime: 30000 (30s for active editing). enabled: !!caseId.
    - useCreateEvent(caseId: string): useMutation POST /api/cases/{caseId}/events, invalidates ["events", caseId] on success.
    - useUpdateEvent(caseId: string): useMutation PATCH /api/cases/{caseId}/events/{id}, invalidates ["events", caseId] on success. (Optimistic updates will be added in plan 03-03.)
    - useDeleteEvent(caseId: string): useMutation DELETE /api/cases/{caseId}/events/{id}, invalidates ["events", caseId] on success.
  </action>
  <verify>TypeScript compilation check: no type errors in event.ts and useEvents.ts</verify>
  <done>TypeScript types and TanStack Query hooks exist for full events CRUD</done>
</task>

<task type="auto">
  <name>Task 2: Timeline UI components and CaseDetailPage integration</name>
  <files>
    client/src/components/timeline/EventTypeIcon.tsx
    client/src/components/timeline/TimelineRow.tsx
    client/src/components/timeline/TimelineView.tsx
    client/src/pages/CaseDetailPage.tsx
  </files>
  <action>
    Create client/src/components/timeline/EventTypeIcon.tsx:
    - Props: type ("finding" | "action" | "note"), className? (string)
    - Use lucide-react icons: AlertTriangle for "finding" (amber), Zap for "action" (blue), StickyNote for "note" (gray)
    - Return icon wrapped in a colored circle div (bg-amber-100 text-amber-600, bg-blue-100 text-blue-600, bg-gray-100 text-gray-600)

    Create client/src/components/timeline/TimelineRow.tsx:
    - Props: event (TimelineEvent), onUpdate (fn), onDelete (fn), isUpdating (boolean)
    - Display as a table row with columns: type icon, date, time, file name, file count, description, file type
    - Date displays as formatted string (e.g., "2026-02-10")
    - Time displays as "14:30" or empty if null
    - Each cell shows the value as plain text (inline editing comes in 03-03)
    - Include a delete button (Trash2 icon from lucide) at the end of the row

    Create client/src/components/timeline/TimelineView.tsx:
    - Props: caseId (string)
    - Uses useEvents(caseId) to fetch events
    - Uses useCreateEvent(caseId) for adding new events
    - Shows loading state while fetching
    - Empty state: "No events yet. Add the first event to start building the timeline."
    - Renders a table with header row: Type, Date, Time, File Name, Count, Description, File Type, Actions
    - Maps events to TimelineRow components
    - "Add Event" button that creates a new event with today's date, type "note", and empty fields
    - Events already come sorted from the API (by event_date, event_time)

    Update client/src/pages/CaseDetailPage.tsx:
    - Import TimelineView
    - Replace the placeholder div in TabsContent value="timeline" with <TimelineView caseId={id!} />
    - Remove the placeholder "Timeline will be available in a future update" text
  </action>
  <verify>No TypeScript compilation errors. CaseDetailPage renders TimelineView in timeline tab.</verify>
  <done>Timeline tab shows chronological events with type icons, add event button, and delete capability</done>
</task>

</tasks>

<verification>
- Timeline tab displays events sorted chronologically
- Event type icons show distinct colors/icons for finding, action, note
- Add Event button creates a new event row
- Delete button removes an event
- Empty state shown when no events exist
</verification>

<success_criteria>
- TypeScript types match backend API response
- TanStack Query hooks provide useEvents, useCreateEvent, useUpdateEvent, useDeleteEvent
- TimelineView renders in CaseDetailPage timeline tab
- Events display with type icons, date, time, and file fields
</success_criteria>

<output>
After completion, create `.planning/phases/03-timeline-events/03-02-SUMMARY.md`
</output>
