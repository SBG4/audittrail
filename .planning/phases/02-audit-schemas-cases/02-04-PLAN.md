---
phase: 02-audit-schemas-cases
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - client/src/pages/CaseListPage.tsx
  - client/src/pages/DashboardPage.tsx
  - client/src/components/cases/CaseList.tsx
  - client/src/components/cases/CaseFilters.tsx
  - client/src/components/ui/table.tsx
  - client/src/components/ui/badge.tsx
  - client/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a list of all cases with case number, title, audit type, status, assignee, and dates"
    - "User can filter the case list by status (open, active, closed)"
    - "User can filter the case list by audit type"
    - "User can search cases by title or description text"
    - "User can navigate from the case list to create a new case"
    - "Case statuses are displayed with color-coded badges"
  artifacts:
    - path: "client/src/pages/CaseListPage.tsx"
      provides: "Main case list page combining filters, table, and actions"
      contains: "CaseListPage"
    - path: "client/src/components/cases/CaseList.tsx"
      provides: "Table component displaying cases"
      contains: "CaseList"
    - path: "client/src/components/cases/CaseFilters.tsx"
      provides: "Filter controls for status, type, and search"
      contains: "CaseFilters"
  key_links:
    - from: "client/src/pages/CaseListPage.tsx"
      to: "client/src/hooks/useCases.ts"
      via: "useCases hook with filters"
      pattern: "useCases"
    - from: "client/src/components/cases/CaseFilters.tsx"
      to: "client/src/hooks/useAuditTypes.ts"
      via: "useAuditTypes for type filter options"
      pattern: "useAuditTypes"
    - from: "client/src/App.tsx"
      to: "client/src/pages/CaseListPage.tsx"
      via: "React Router default route"
      pattern: "CaseListPage"
---

<objective>
Create the case list dashboard with a filterable, searchable table of cases, status badges, and navigation to case creation and detail views.

Purpose: Provides the primary case management interface where auditors see all cases, filter by status/type, search, and navigate to individual cases.
Output: CaseListPage with CaseFilters and CaseList table, integrated into the app router as the default authenticated page.
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-audit-schemas-cases/02-RESEARCH.md
@.planning/phases/02-audit-schemas-cases/02-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: CaseFilters and CaseList components</name>
  <files>
    client/src/components/cases/CaseFilters.tsx
    client/src/components/cases/CaseList.tsx
    client/src/components/ui/table.tsx
    client/src/components/ui/badge.tsx
  </files>
  <action>
    Add shadcn components:
    ```bash
    cd client && npx shadcn@latest add table badge
    ```

    Create `client/src/components/cases/CaseFilters.tsx`:
    - Props: filters (CaseFilters type), onFiltersChange (callback receiving updated filters)
    - Layout: horizontal flex row with gap, wrapping on mobile
    - Controls:
      1. **Search input**: Input with placeholder "Search cases...", debounced to 300ms (use a simple setTimeout debounce, no extra library). Updates filters.search.
      2. **Status filter**: Select with options: All Statuses, Open, Active, Closed. Updates filters.status (empty string for "all").
      3. **Audit type filter**: Select populated from useAuditTypes() hook. Options: All Types, then each audit type by name. Updates filters.audit_type_id.
    - When any filter changes, call onFiltersChange with the updated filters object. Reset offset to 0 when filters change.
    - Use existing shadcn Select, Input components
    - Include a "Clear filters" button that resets all filters to default

    Create `client/src/components/cases/CaseList.tsx`:
    - Props: cases (Case[]), total (number), offset (number), limit (number), onPageChange (callback), onCaseClick (callback receiving case id), isLoading (boolean)
    - Renders a shadcn Table with columns:
      1. # (case_number)
      2. Title (truncated to ~50 chars if longer)
      3. Type (audit_type.name)
      4. Status (color-coded Badge: open=blue/default, active=green, closed=gray)
      5. Assigned To (assigned_to.full_name or "Unassigned" in muted text)
      6. Updated (relative or formatted date from updated_at)
    - Each row is clickable (onClick -> onCaseClick(case.id))
    - Loading state: Show a subtle loading indicator (e.g., opacity reduction on table body or a skeleton)
    - Empty state: Show "No cases found" message with a link to create a new case
    - Pagination: Below the table, show "Showing X-Y of Z cases" with Previous/Next buttons. Disable Previous when offset=0, disable Next when offset+limit >= total.
    - Status badge colors: "open" -> variant="outline" with blue text, "active" -> variant="default" (primary color), "closed" -> variant="secondary"
  </action>
  <verify>
    - `cd client && npx tsc --noEmit` passes
    - CaseFilters.tsx and CaseList.tsx exist with correct component names
  </verify>
  <done>CaseFilters provides search, status, and audit type filtering. CaseList renders a paginated table with color-coded status badges, clickable rows, and empty/loading states.</done>
</task>

<task type="auto">
  <name>Task 2: CaseListPage integration and router update</name>
  <files>
    client/src/pages/CaseListPage.tsx
    client/src/pages/DashboardPage.tsx
    client/src/App.tsx
  </files>
  <action>
    Create `client/src/pages/CaseListPage.tsx`:
    - Page header: "Cases" title on the left, "New Case" button (links to /cases/new) on the right. Use a flex row with justify-between.
    - Uses React useState for filters state (CaseFilters type), initialized with empty/default values
    - Renders CaseFilters component, passing filters and onFiltersChange callback
    - Uses useCases(filters) hook to fetch case data
    - Renders CaseList component, passing cases data, pagination info, loading state
    - onCaseClick: navigates to /cases/{id} using react-router useNavigate
    - onPageChange: updates filters.offset
    - Handle loading state from useCases (show loading state in CaseList)
    - Handle error state: show error message if query fails

    Update `client/src/pages/DashboardPage.tsx`:
    - Replace the current placeholder dashboard content with a redirect or direct rendering of the CaseListPage
    - Option A (preferred): Remove DashboardPage and point the index route directly to CaseListPage
    - Option B: Keep DashboardPage as a thin wrapper that renders CaseListPage

    Update `client/src/App.tsx`:
    - Replace DashboardPage with CaseListPage as the index route (path="/")
    - Add route: `/cases/new` -> CaseCreatePage (if not already added in 02-03)
    - Add route: `/cases/:id` -> placeholder (will be implemented in 02-05, for now use a simple "Case Detail - coming soon" page or just render CaseListPage)
    - Ensure all new routes are inside the AuthGuard + Layout wrapper
    - Import all new page components
  </action>
  <verify>
    - `cd client && pnpm build` succeeds
    - `cd client && npx tsc --noEmit` passes
    - App.tsx has routes for /, /cases/new, and /cases/:id
  </verify>
  <done>CaseListPage is the default authenticated page showing filterable, searchable case table. Navigation between case list, case creation, and case detail routes works.</done>
</task>

</tasks>

<verification>
- CaseListPage renders on the default authenticated route (/)
- Filter controls for status, audit type, and search are visible
- Selecting a filter updates the case list via API call
- Cases display with case number, title, type, status badge, assignee, and date
- Status badges have distinct colors (open=blue, active=green, closed=gray)
- Pagination shows correct counts and Previous/Next buttons work
- Empty state message appears when no cases match filters
- "New Case" button navigates to /cases/new
- Clicking a case row navigates to /cases/:id
- Client builds without errors
</verification>

<success_criteria>
1. User can view a list of all cases with relevant columns (CASE-06)
2. User can filter cases by status (open/active/closed) (CASE-06)
3. User can filter cases by audit type (CASE-06)
4. User can search cases by title or description text (CASE-06)
5. Case statuses display with color-coded badges
6. User can navigate to create a new case from the list
7. User can click a case to navigate to its detail page
</success_criteria>

<output>
After completion, create `.planning/phases/02-audit-schemas-cases/02-04-SUMMARY.md`
</output>
