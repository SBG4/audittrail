---
phase: 09-completeness-packaging
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/lib/completeness.ts
  - client/src/components/timeline/InlineField.tsx
  - client/src/components/timeline/TimelineRow.tsx
  - client/src/components/cases/CaseMetadata.tsx
  - client/src/components/cases/CaseList.tsx
autonomous: true

must_haves:
  truths:
    - "Empty/missing fields display a visible amber indicator throughout the application"
    - "Filled fields display normally with no visual change"
    - "Zero values (like file_count=0) are treated as filled, not empty"
  artifacts:
    - path: "client/src/lib/completeness.ts"
      provides: "Completeness utility functions"
      exports: ["isEmpty", "getCaseCompleteness", "getEventCompleteness", "getCompletenessScore", "FieldStatus"]
    - path: "client/src/components/timeline/InlineField.tsx"
      provides: "Amber indicator for empty inline fields"
    - path: "client/src/components/cases/CaseMetadata.tsx"
      provides: "Amber indicator for empty metadata fields"
  key_links:
    - from: "client/src/components/timeline/InlineField.tsx"
      to: "client/src/lib/completeness.ts"
      via: "isEmpty utility import"
      pattern: "import.*isEmpty.*completeness"
---

<objective>
Add color-coded missing field indicators throughout the application. Empty or null fields display with an amber background/border to visually alert auditors to incomplete data.

Purpose: Implements COMP-01 -- auditors need immediate visual feedback about data gaps
Output: Completeness utility module + amber indicators on InlineField, CaseMetadata view mode, and CaseList
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@client/src/lib/completeness.ts
@client/src/components/timeline/InlineField.tsx
@client/src/components/timeline/TimelineRow.tsx
@client/src/components/cases/CaseMetadata.tsx
@client/src/components/cases/CaseList.tsx
@client/src/types/case.ts
@client/src/types/event.ts
@client/src/types/file-batch.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create completeness utility module</name>
  <files>client/src/lib/completeness.ts</files>
  <action>
Create `client/src/lib/completeness.ts` with these exports:

1. **`isEmpty(value: unknown): boolean`** -- Returns true for null, undefined, and empty string "". Returns false for 0, false, and any other truthy/falsy values. This is the single source of truth for "is this field empty?" across the entire app.

2. **`FieldStatus` interface** -- `{ field: string; label: string; filled: boolean; required: boolean }`

3. **`getCaseCompleteness(case_: Case): FieldStatus[]`** -- Checks core case fields (title, description, assigned_to_id) plus all metadata fields defined in `case_.audit_type.schema.properties`. For metadata, uses `schema.required` array to set the `required` flag. Import Case type from `@/types/case`.

4. **`getEventCompleteness(event: TimelineEvent): FieldStatus[]`** -- Checks event_date (required), event_time, file_name, file_count, file_description, file_type. Only event_date is required. Import TimelineEvent from `@/types/event`.

5. **`getCompletenessScore(fields: FieldStatus[]): { filled: number; total: number; percentage: number; allRequiredFilled: boolean }`** -- Calculates completion stats from FieldStatus array. percentage = Math.round((filled / total) * 100), handles total=0 case (returns 100).
  </action>
  <verify>File exists with all 5 exports. TypeScript compiles (checked by attempting import in another file or reviewing types).</verify>
  <done>completeness.ts has isEmpty, FieldStatus, getCaseCompleteness, getEventCompleteness, getCompletenessScore exported and correctly typed.</done>
</task>

<task type="auto">
  <name>Task 2: Add amber indicators to InlineField, CaseMetadata, and CaseList</name>
  <files>
    client/src/components/timeline/InlineField.tsx
    client/src/components/cases/CaseMetadata.tsx
    client/src/components/cases/CaseList.tsx
  </files>
  <action>
**InlineField.tsx:**
- Import `isEmpty` from `@/lib/completeness`
- In the non-editing display mode, when value is empty (using `isEmpty(value)`), change the span styling to include amber indicator:
  - Replace the existing muted placeholder styling with: `bg-amber-50 border border-amber-200 text-amber-600 dark:bg-amber-900/20 dark:border-amber-700 dark:text-amber-400`
  - Keep the placeholder text (e.g., "File name...") but render it with the amber styling instead of just italic muted text
  - When value is filled, keep the existing styling unchanged (no amber)

**CaseMetadata.tsx:**
- Import `isEmpty` from `@/lib/completeness`
- In the VIEW mode grid (the entries.map section), when a metadata value is empty (`isEmpty(value)`), change the "Not set" text container to use amber indicator styling:
  - Replace `text-sm text-muted-foreground italic` with `text-sm text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded px-2 py-0.5 inline-block`
  - Change text from "Not set" to "Missing"

**CaseList.tsx:**
- Import `getCaseCompleteness, getCompletenessScore` from `@/lib/completeness`
- In each case row, after the existing content, add a small completeness badge:
  - Calculate score using `getCompletenessScore(getCaseCompleteness(case_))`
  - If percentage < 100, show a small Badge with amber styling: `{percentage}%` with `className="bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200"`
  - If percentage === 100, either show nothing or a green check icon
  </action>
  <verify>Visual inspection of changed components. Empty fields show amber background. Filled fields show normal styling. Check that CaseList rows show completion percentage badges.</verify>
  <done>Empty fields across InlineField, CaseMetadata, and CaseList display amber color indicators. Filled fields display normally. The isEmpty utility handles edge cases (0 is not empty, null/undefined/"" are empty).</done>
</task>

</tasks>

<verification>
1. InlineField with null/empty value shows amber-highlighted "Missing" or placeholder text
2. InlineField with a filled value shows normal text, no amber
3. CaseMetadata empty fields show amber "Missing" badge, filled fields show value normally
4. CaseList rows show amber completion percentage badge when case is incomplete
5. file_count of 0 does NOT trigger missing indicator
</verification>

<success_criteria>
- All empty/null fields display visible amber color indicator (bg-amber-50/border-amber-200)
- Filled fields display without any color change
- Zero values treated as filled (not empty)
- Completeness utility functions are reusable for plan 09-02
</success_criteria>

<output>
After completion, create `.planning/phases/09-completeness-packaging/09-01-SUMMARY.md`
</output>
