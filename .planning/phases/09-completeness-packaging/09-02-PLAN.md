---
phase: 09-completeness-packaging
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - client/src/pages/CaseReviewPage.tsx
  - client/src/hooks/useEvents.ts
  - client/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "A case review screen shows completeness checklist highlighting all incomplete fields before report generation"
    - "Review screen shows case-level, event-level, and file-batch-level completeness"
    - "User can navigate to review screen from case detail page"
  artifacts:
    - path: "client/src/pages/CaseReviewPage.tsx"
      provides: "Pre-report completeness review screen"
    - path: "client/src/App.tsx"
      provides: "Route for /cases/:id/review"
  key_links:
    - from: "client/src/pages/CaseReviewPage.tsx"
      to: "client/src/lib/completeness.ts"
      via: "getCaseCompleteness, getEventCompleteness, getCompletenessScore imports"
      pattern: "import.*completeness"
    - from: "client/src/pages/CaseReviewPage.tsx"
      to: "client/src/hooks/useCases.ts"
      via: "useCase hook for case data"
      pattern: "useCase"
---

<objective>
Create a pre-report case review screen that aggregates completeness data across the entire case -- metadata, timeline events, and file batches -- into a visual checklist auditors can review before generating a report.

Purpose: Implements COMP-02 -- auditors need to review case completeness before report generation
Output: CaseReviewPage component with completeness checklist + route
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-completeness-packaging/09-01-SUMMARY.md
@client/src/lib/completeness.ts
@client/src/pages/CaseDetailPage.tsx
@client/src/hooks/useCases.ts
@client/src/hooks/useEvents.ts
@client/src/types/case.ts
@client/src/types/event.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CaseReviewPage with completeness checklist</name>
  <files>client/src/pages/CaseReviewPage.tsx</files>
  <action>
Create `client/src/pages/CaseReviewPage.tsx`:

**Data fetching:**
- Use `useParams` to get case ID
- Use `useCase(id)` hook to fetch case data
- Use `useEvents(id)` hook to fetch all events for the case

**Layout structure (top to bottom):**

1. **Header:** Back link to case detail, case title, case number badge
2. **Overall Score:** Large circular or bar progress indicator showing overall completeness percentage. Use Tailwind width classes for a simple progress bar. Color: green (>=80%), amber (50-79%), red (<50%).

3. **Case Details Section** (collapsible card):
   - Title: "Case Details" with filled/total count
   - Run `getCaseCompleteness(case_)` to get field statuses
   - Render each field as a row with:
     - CheckCircle icon (green) if filled, AlertTriangle icon (amber) if empty
     - Field label
     - Current value (or "Missing" in amber)
   - Show required fields with a red asterisk

4. **Timeline Events Section** (collapsible card):
   - Title: "Timeline Events ({n} events)" with overall event fill rate
   - If no events: show amber warning "No events in timeline"
   - For each event, show a sub-section:
     - Event summary line: "Event {index+1}: {event_type} - {event_date}"
     - Run `getEventCompleteness(event)` for each
     - List missing fields with amber indicators
     - List filled fields with green checks
   - Collapse individual events by default, expand those with missing fields

5. **File Batches Section** (collapsible card):
   - Title: "File Batches"
   - For each event that has file_batches, show batch count
   - Events with zero batches show amber warning "No file batches attached"
   - For batches: check label (required), file_count, description, file_types

6. **Summary Bar** at bottom:
   - Total fields checked, total filled, total missing
   - "Ready for report" if all required fields are filled (green)
   - "Review needed" if any required fields missing (amber)
   - A button "Back to Case" linking to `/cases/:id`

**Styling:** Use existing shadcn Card, Badge components. Use lucide-react CheckCircle2 (green), AlertTriangle (amber), CircleDot (neutral). Amber indicator classes: `text-amber-600 dark:text-amber-400`, `bg-amber-50 dark:bg-amber-900/20`.

**No new API calls needed** -- all data is available from useCase and useEvents hooks.
  </action>
  <verify>File exists, component renders without errors, all sections display completeness data.</verify>
  <done>CaseReviewPage shows case details completeness, event completeness per-event, file batch completeness, and overall score with clear visual indicators for missing vs filled fields.</done>
</task>

<task type="auto">
  <name>Task 2: Add review route and navigation</name>
  <files>
    client/src/App.tsx
    client/src/pages/CaseDetailPage.tsx
  </files>
  <action>
**App.tsx:**
- Import CaseReviewPage from `@/pages/CaseReviewPage`
- Add route: `<Route path="/cases/:id/review" element={<CaseReviewPage />} />` inside the AuthGuard/Layout routes, after the /cases/:id route

**CaseDetailPage.tsx:**
- Add a "Review Completeness" button in the header area (near the status/assignment row, or in the tabs)
- Use Link component to navigate to `/cases/${id}/review`
- Style as outline button with a clipboard-check or shield-check icon from lucide-react
- Import `getCaseCompleteness, getCompletenessScore` from `@/lib/completeness` to show a small inline score next to the button (e.g., "Review (75%)")
  </action>
  <verify>Navigate to /cases/:id/review in browser. Button on CaseDetailPage links to review page. Review page loads case data and shows completeness checklist.</verify>
  <done>Review route exists at /cases/:id/review, CaseDetailPage has "Review Completeness" button with inline percentage, review page loads and displays full completeness analysis.</done>
</task>

</tasks>

<verification>
1. Navigate to any case -> click "Review Completeness" -> see review page
2. Review page shows case detail completeness with field-level indicators
3. Review page shows per-event completeness for all timeline events
4. Review page shows file batch presence/absence per event
5. Overall score bar accurately reflects data completeness
6. "Ready for report" / "Review needed" summary based on required fields
</verification>

<success_criteria>
- Case review screen accessible from case detail page
- All incomplete fields highlighted with amber indicators
- All complete fields shown with green check marks
- Overall completeness score displayed prominently
- Review covers case metadata, all events, and file batches
</success_criteria>

<output>
After completion, create `.planning/phases/09-completeness-packaging/09-02-SUMMARY.md`
</output>
