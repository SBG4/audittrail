---
phase: 07-reports-pdf-docx
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - server/src/templates/reports/base.html
  - server/src/templates/reports/timeline.html
  - server/src/templates/reports/narrative.html
autonomous: true

must_haves:
  truths:
    - "Timeline template renders case summary and chronological events table"
    - "Narrative template renders findings, conclusions, and recommendations sections"
    - "Both templates use professional CSS styling with page break controls"
  artifacts:
    - path: "server/src/templates/reports/base.html"
      provides: "Base HTML layout with CSS for PDF rendering"
    - path: "server/src/templates/reports/timeline.html"
      provides: "Quick timeline report template"
    - path: "server/src/templates/reports/narrative.html"
      provides: "Detailed narrative report template"
  key_links:
    - from: "server/src/templates/reports/timeline.html"
      to: "server/src/templates/reports/base.html"
      via: "Jinja2 extends"
    - from: "server/src/templates/reports/narrative.html"
      to: "server/src/templates/reports/base.html"
      via: "Jinja2 extends"
---

<objective>
Create Jinja2 HTML report templates for both timeline and narrative modes with professional styling.

Purpose: Templates are the visual layer that transforms report data into formatted HTML for PDF rendering.
Output: Three HTML template files with CSS for professional report output.
</objective>

<execution_context>
@/Users/shiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-reports-pdf-docx/07-01-SUMMARY.md
@server/src/services/report_generator.py
@server/src/schemas/report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Base HTML template with professional CSS</name>
  <files>server/src/templates/reports/base.html</files>
  <action>
Create directory server/src/templates/reports/ if it doesn't exist.

Create server/src/templates/reports/base.html as a Jinja2 base template:
- DOCTYPE html with UTF-8 charset
- Embedded CSS (no external stylesheets -- must be self-contained for WeasyPrint):
  - Professional serif font stack (Georgia, serif) for body, sans-serif (Arial, Helvetica) for headings
  - @page rule: A4 size, 2cm margins
  - @page rule with @top-center for report title, @bottom-center for page numbers using counter(page)
  - @page :first rule to suppress header/footer on cover page
  - Clean typography: line-height 1.6, color #333
  - Table styles: full-width, collapsed borders, alternating row colors (#f9f9f9), header row with dark background (#2c3e50, white text)
  - Section heading styles (h1, h2, h3) with bottom borders
  - .cover-page class: centered, full-page, with report title, case number, date
  - .metadata-table class: two-column layout for case info key-value pairs
  - .event-type-badge classes: colored inline badges for finding (red), action (blue), note (gray)
  - .file-batch class: indented sub-section styling
  - page-break-before: always on .new-page class
  - page-break-inside: avoid on table rows and .no-break class
- Jinja2 blocks: {% block title %}, {% block content %}
  </action>
  <verify>File exists and contains valid HTML with Jinja2 block tags: `test -f /Users/shiro/projec1/server/src/templates/reports/base.html && echo "OK"`</verify>
  <done>Base template has embedded CSS with @page rules, table styles, typography, and Jinja2 blocks.</done>
</task>

<task type="auto">
  <name>Task 2: Timeline and narrative report templates</name>
  <files>server/src/templates/reports/timeline.html, server/src/templates/reports/narrative.html</files>
  <action>
Create server/src/templates/reports/timeline.html:
- Extends base.html
- Cover page section:
  - "Audit Case Report" title
  - "Quick Timeline" subtitle
  - Case number and title
  - Generated date
- Case Summary section:
  - Metadata table with: Case #, Title, Audit Type, Status, Assigned To, Created By, Created At
  - Description paragraph (if present)
  - Case metadata fields from audit type schema (loop over metadata dict)
- Timeline Events section:
  - HTML table with columns: Date, Time, Type, File Name, Count, Description, File Type
  - Loop over events list
  - Event type shown as colored badge
  - For each event with file_batches, render a sub-row or nested section showing batch details (label, count, types, description)
- Footer with generation timestamp and user

Create server/src/templates/reports/narrative.html:
- Extends base.html
- Cover page section:
  - "Audit Case Report" title
  - "Detailed Narrative" subtitle
  - Case number and title
  - Generated date
- Executive Summary section:
  - Case overview paragraph (auto-generated from case data)
  - Key metrics: total events count, date range (first to last event), total file count across all events
- Case Details section:
  - Same metadata table as timeline mode
- Findings section:
  - Heading "Findings"
  - Filter events where event_type == "finding"
  - Render each finding as a numbered item with date, description, file details
  - Include file batches for each finding event
- Actions section:
  - Heading "Actions Taken"
  - Filter events where event_type == "action"
  - Render each action as a numbered item
- Notes section:
  - Heading "Supporting Notes"
  - Filter events where event_type == "note"
  - Render each note
- Complete Timeline section:
  - Same table as timeline mode (all events chronologically)
- Conclusions section:
  - Placeholder text: "[Add conclusions here]"
- Recommendations section:
  - Placeholder text: "[Add recommendations here]"

Both templates should use Jinja2 filters for date formatting and handle empty/null values gracefully with default text like "N/A" or "Not specified".
  </action>
  <verify>Files exist: `test -f /Users/shiro/projec1/server/src/templates/reports/timeline.html && test -f /Users/shiro/projec1/server/src/templates/reports/narrative.html && echo "OK"`</verify>
  <done>Timeline template shows case summary + chronological events table. Narrative template shows findings/actions/notes sections plus full timeline.</done>
</task>

</tasks>

<verification>
- All three template files exist in server/src/templates/reports/
- Templates use {% extends "reports/base.html" %} and {% block content %}
- Templates reference variables from collect_report_data (case, events, metadata, etc.)
</verification>

<success_criteria>
- Base template has professional CSS with @page rules, table styles, and Jinja2 blocks
- Timeline template renders case summary + events table
- Narrative template renders findings, actions, notes sections + full timeline
- Both templates handle empty data gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/07-reports-pdf-docx/07-02-SUMMARY.md`
</output>
